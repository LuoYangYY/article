## ã€Šå‰ç«¯è„šæ‰‹æ¶ CLIã€‹ç¨‹åºå‘˜é«˜é…

### ä¸€ã€å‰è¨€

ä»é™æ€é¡µé¢åˆ° JavaScriptï¼Œä»ä¾èµ–åç«¯åˆ°è‡ªä¸»å¼€å‘ï¼Œä»æ²¡æœ‰ä¸“èŒçš„â€œå‰ç«¯å¼€å‘â€œåˆ°é«˜è–ªâ€œå‰ç«¯å¼€å‘â€ï¼Œå‰ç«¯ç»å†äº†ä¸€ä¸ªæ¼«é•¿çš„å‘å±•è¿‡ç¨‹ï¼Œå‰ç«¯æŠ€æœ¯ä¹Ÿå‘å±•åˆ°äº†å‰æ‰€æœªæœ‰çš„é«˜åº¦ï¼Œå¯¹å‰ç«¯å¼€å‘è€…çš„èƒ½åŠ›è¦æ±‚ä¹Ÿè¶Šæ¥è¶Šé«˜ã€‚å¦‚æœä½ ä¸ç”˜äºåªåšæ¬è¿å·¥ï¼Œæƒ³è¦ä½é…å˜é«˜é…ï¼Œä¸‹é¢è¿™ä¸ªä¸œè¥¿ä¸€å®šè¦å¥½å¥½äº†è§£ä¸‹ã€‚æ¥ï¼å·¦æ‰‹è·Ÿæˆ‘ä¸€èµ·ç”»æ¡é¾™ï¼Œå³æ‰‹ç”»ä¸€é“å½©è™¹ï¼ä½ å°±æ˜¯æœ€å±Œçš„çªœå¤©çŒ´ã€‚

### äºŒã€æ¦‚å¿µ

CLIï¼Œå…¨ç§°æ˜¯ command-line interfaceï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤è¡Œç•Œé¢ã€‚å‰ç«¯è„šæ‰‹æ¶ CLIï¼Œæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œ
å®ƒçš„å‡ºç°æ˜¯ä¸ºäº†å‡å°‘é‡å¤æ€§å·¥ä½œã€è§„èŒƒç›®å½•ç»“æ„ã€ç»Ÿä¸€å¼€å‘é£æ ¼ï¼Œè®©äº‹æƒ…ç®€å•åŒ–ï¼Œä¸€é”®å‘½ä»¤å°±å¯ä»¥æ ¹æ®äº‹å…ˆçº¦å®šçš„è§„èŒƒåˆ›å»ºé¡¹ç›®ï¼Œå†æ‰§è¡Œä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥è¿è¡Œé¡¹ç›®ï¼Œè®©å¼€å‘è€…æ— éœ€å…³æ³¨é…ç½®ä»€ä¹ˆçš„ï¼Œåªéœ€è¦å¼€å¿ƒå†™ä»£ç ï¼Œç›¸åŒçš„é¡¹ç›®ç»“æ„å’Œä»£ç è§„èŒƒï¼Œå¾ˆåˆ©äºé¡¹ç›®çš„åæœŸç»´æŠ¤ï¼Œæé«˜æ•ˆç‡çš„åŒæ—¶è¿˜é™ä½äº†å­¦ä¹ æˆæœ¬ã€‚

éšç€å‰ç«¯å·¥ç¨‹åŒ–çš„ç†å¿µä¸æ–­æ·±å…¥ï¼Œè¶Šæ¥è¶Šå¤šçš„äººé€‰æ‹©ä½¿ç”¨è„šæ‰‹æ¶æ¥ä»é›¶åˆ°ä¸€æ­å»ºè‡ªå·±çš„é¡¹ç›®ã€‚å…¶ä¸­å¤§å®¶æœ€ç†Ÿæ‚‰çš„å°±æ˜¯ create-react-app å’Œ vue-cliï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©æˆ‘ä»¬â€æ­å»º-è¿è¡Œ-æ„å»ºâ€œé¡¹ç›®ã€‚è™½ç„¶ä¸šç•Œå·²ç»æœ‰æˆç†Ÿçš„è„šæ‰‹æ¶ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬è‡ªå·±å¼€å‘çš„è¿‡ç¨‹ä¸­ä¼šå‘ç°ï¼Œéšç€ä¸šåŠ¡çš„ä¸æ–­å¹´å‘å±•ï¼Œå¿…ç„¶ä¼šå‡ºç°éœ€è¦é’ˆå¯¹ä¸šåŠ¡å¼€å‘çš„å®é™…æƒ…å†µæ¥è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚é¡¹ç›®æ¶æ„è°ƒæ•´ã€èåˆå…¬å¸å¼€å‘å·¥å…·ç­‰ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬æ²‰æ·€å‡ºä¸€å¥—å±äºè‡ªå·±çš„æ›´åŠ â€ä¸ªæ€§åŒ–â€œçš„ä¸šåŠ¡æ–¹æ¡ˆã€‚è¿™æ—¶å¦‚æœä½ èƒ½ä¸ºå…¬å¸å¼€å‘ä¸€ä¸ªå®šåˆ¶åŒ–çš„è„šæ‰‹æ¶ï¼Œé‚£ä¹ˆä½ ä¼šå‘ç°æ•´ä¸ªå…¬å¸å‰ç«¯éƒ½æ˜¯ä½ çš„å¤©ä¸‹ï¼Œä½ å°±æ˜¯å…¬å¸æœ€äº®çš„ä»”ğŸ˜†ã€‚

å¤§å®¶ç†Ÿæ‚‰çš„è„šæ‰‹æ¶åŸºæœ¬éƒ½æ˜¯ Nodejs å¼€å‘çš„,æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¹Ÿç®€å•ä»‹ç»ä¸‹åœ¨æ­å»ºè„šæ‰‹æ¶ CLI æ—¶å€™éœ€è¦äº†è§£çš„ Nodejs ç›¸å…³çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚é€šè¿‡ `npm init` å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ª node é¡¹ç›®ï¼Œå¹¶å¯ä»¥æ ¹æ®å‘½ä»¤è¡Œè¯¢é—®è¾“å…¥ç”Ÿæˆä¸€ä¸ª package.json é…ç½®æ–‡ä»¶ï¼Œæœ€é‡è¦çš„æ˜¯ package.json å¯é…ç½® bin å­—æ®µç”¨æ¥æŒ‡å®šå„ä¸ªå†…éƒ¨æ–‡ä»¶å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ npm ä¼šå°†å®ƒç›´æ¥å¯¼å…¥åˆ°å…¨å±€è·¯å¾„é‡Œï¼Œæ‰“æˆå…¨å±€åŒ…çš„å‘½ä»¤ç›´æ¥ä½¿ç”¨ã€‚

### ä¸‰ã€æ€è·¯

åœ¨åŠ¨æ‰‹å¼€å§‹å¼€å‘å‰ç«¯è„šæ‰‹æ¶ CLI ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆæ‹ä¸€ä¸‹æ€è·¯ï¼Œçºµè§ˆä¸šç•Œæ¯”è¾ƒæµè¡Œçš„å‡ ä¸ªè„šæ‰‹æ¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°è™½ç„¶å®ƒä»¬åŠŸèƒ½ä¸°å¯Œåº¦å’Œå¤æ‚ç¨‹åº¦ä¸ä¸€æ ·ï¼Œä½†æ˜¯æ€»ä½“æ¥è¯´éƒ½ä¼šåŒ…å«ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š

* CLI æ­å»ºé¡¹ç›®
    - æ ¹æ®ç”¨æˆ·è¾“å…¥ç”Ÿæˆé…ç½®æ–‡ä»¶
    - ä¸‹è½½æŒ‡å®šé¡¹ç›®æ¨¡æ¿
    - åœ¨ç›®æ ‡ç›®å½•ç”Ÿæˆæ–°é¡¹ç›®
* CLI è¿è¡Œé¡¹ç›®
    - æœ¬åœ°å¯åŠ¨é¢„è§ˆ
    - çƒ­æ›´æ–°
    - è¯­æ³•ã€ä»£ç è§„èŒƒæ£€æµ‹
* éƒ¨ç½²é¡¹ç›®
    - é¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡ç«¯

ä¸Šé¢æ˜¯è„šæ‰‹æ¶è¦å®ç°çš„åŠŸèƒ½ï¼ŒåŒæ—¶æˆ‘ä»¬è‚¯å®šä¹Ÿå¸Œæœ›è‡ªå·±çš„è„šæ‰‹æ¶æœ‰æ›´å¹¿æ³›çš„åº”ç”¨ï¼Œæ‰€ä»¥è¿˜è¦æ€è€ƒå¦‚ä½•æä¾›ç»™ä»–äººä½¿ç”¨ï¼Œå¦‚ä½•æä¾›ä¸€ä¸ªä»–äººå€¾å¿ƒçš„è„šæ‰‹æ¶ï¼Œè®©å¤§å®¶çˆ±ä¸Šå®ƒï¼Œç»™å®ƒå°å¿ƒå¿ƒâ™¥(Ë†â—¡Ë†Ô…)ã€‚

* npm åŒ…çš„æ–¹å¼æä¾›è„šæ‰‹æ¶
* ä¼˜é›…çš„è¾“å‡ºæ—¥å¿—ï¼Œæ¸…æ™°å¥½çœ‹

##### ä¾èµ–åˆ†æ
ä¸ºäº†å®ç°æˆ‘ä»¬ç¥å¥‡ä¼Ÿå¤§çš„è„šæ‰‹æ¶ï¼Œå¯ä»¥å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼š

* babel-cli/babel-envï¼šè¯­æ³•è½¬æ¢å·¥å…·ï¼Œæœ‰äº†å®ƒæˆ‘ä»¬åœ¨å¼€å‘è„šæ‰‹æ¶çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ ES6 è¯­æ³•äº†ï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆè¦ç”¨ ES6ï¼Œå› ä¸ºå®ƒç¥å¥‡è€Œä¼Ÿå¤§
* commanderï¼šå‘½ä»¤è¡Œå·¥å…·ï¼Œæœ‰äº†å®ƒæˆ‘ä»¬å°±å¯ä»¥è¯»å–å‘½ä»¤è¡Œå‘½ä»¤ï¼ŒçŸ¥é“ç”¨æˆ·æƒ³è¦åšä»€ä¹ˆäº†
* inquirerï¼š äº¤äº’å¼å‘½ä»¤è¡Œå·¥å…·ï¼Œç»™ç”¨æˆ·æä¾›ä¸€ä¸ªæ¼‚äº®çš„ç•Œé¢å’Œæå‡ºé—®é¢˜æµçš„æ–¹å¼
* download-git-repoï¼šä¸‹è½½è¿œç¨‹æ¨¡æ¿å·¥å…·ï¼Œè´Ÿè´£ä¸‹è½½è¿œç¨‹ä»“åº“çš„æ¨¡æ¿é¡¹ç›®
* chalkï¼šé¢œè‰²æ’ä»¶ï¼Œç”¨æ¥ä¿®æ”¹å‘½ä»¤è¡Œè¾“å‡ºæ ·å¼ï¼Œé€šè¿‡é¢œè‰²åŒºåˆ† infoã€error æ—¥å¿—ï¼Œæ¸…æ™°ç›´è§‚
* oraï¼šç”¨äºæ˜¾ç¤ºåŠ è½½ä¸­çš„æ•ˆæœï¼Œç±»ä¼¼äºå‰ç«¯é¡µé¢çš„ loading æ•ˆæœï¼Œåƒä¸‹è½½æ¨¡æ¿è¿™ç§è€—æ—¶çš„æ“ä½œï¼Œæœ‰äº† loading æ•ˆæœå¯ä»¥æç¤ºç”¨æˆ·æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…
* log-symbolsï¼šæ—¥å¿—å½©è‰²ç¬¦å·ï¼Œç”¨æ¥æ˜¾ç¤ºâˆš æˆ– Ã— ç­‰çš„å›¾æ ‡

### å››ã€å‰æœŸå‡†å¤‡

####4.1 å‡†å¤‡ä¸€ä¸ªé¡¹ç›®æ¨¡æ¿

è„šæ‰‹æ¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç”Ÿæˆä¸€å¥—æŒ‡å®šçš„é¡¹ç›®ç»“æ„å’Œé…ç½®ï¼Œæœ€å¸¸ç”¨çš„æ–¹å¼å°±æ˜¯æˆ‘ä»¬æå‰å‡†å¤‡å¥½ä¸€å¥—é€šç”¨çš„ã€æ˜“ç”¨çš„ã€è§„èŒƒçš„é¡¹ç›®æ¨¡æ¿å­˜æ”¾åœ¨æŒ‡å®šä½ç½®ï¼Œåœ¨è„šæ‰‹æ¶æ‰§è¡Œåˆ›å»ºé¡¹ç›®å‘½ä»¤çš„æ—¶å€™ï¼Œç›´æ¥å°†å‡†å¤‡å¥½çš„æ¨¡æ¿æ‹·è´åˆ°ç›®æ ‡ç›®å½•ä¸‹ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªç‚¹éœ€è¦æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹

* é¡¹ç›®æ¨¡æ¿å­˜æ”¾ä½ç½®

    é¡¹ç›®æ¨¡æ¿å­˜æ”¾é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯å’Œè„šæ‰‹æ¶æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œåœ¨å®‰è£…è„šæ‰‹æ¶çš„æ—¶å€™å°±ä¼šå°†é¡¹ç›®æ¨¡æ¿å­˜æ”¾åœ¨å…¨å±€ç›®å½•ä¸‹äº†ï¼Œè¿™ç§æ–¹å¼æ¯æ¬¡åˆ›å»ºé¡¹ç›®çš„æ—¶å€™éƒ½æ˜¯ä»æœ¬åœ°æ‹·è´çš„é€Ÿåº¦å¾ˆå¿«ï¼Œä½†æ˜¯é¡¹ç›®æ¨¡æ¿è‡ªèº«å‡çº§æ¯”è¾ƒå›°éš¾ã€‚å¦ä¸€ç§æ˜¯å°†é¡¹ç›®æ¨¡æ¿å­˜åœ¨è¿œç«¯ä»“åº“ï¼ˆæ¯”å¦‚ githubã€gitlab ç­‰ä»“åº“ï¼‰ï¼Œè¿™ç§æ–¹å¼æ¯æ¬¡åˆ›å»ºé¡¹ç›®çš„æ—¶å€™éƒ½æ˜¯é€šè¿‡æŸä¸ªåœ°å€åŠ¨æ€ä¸‹è½½çš„ï¼Œé¡¹ç›®æ¨¡æ¿æ›´æ–°æ–¹ä¾¿ã€‚æˆ‘æ›´å–œæ¬¢ç”¨è¿œç«¯ä»“åº“å­˜å‚¨çš„æ–¹å¼ï¼Œè§£è€¦äº†æ¨¡æ¿å’Œè„šæ‰‹æ¶ï¼Œæ–¹ä¾¿æ›´æ–°ç»´æŠ¤ã€‚

* é¡¹ç›®æ¨¡æ¿åŠŸèƒ½ä¸°å¯Œåº¦

    æ‰€è°“é¡¹ç›®æ¨¡æ¿ï¼Œå¿…ç„¶æ˜¯ä¸€ä¸ªå¯ä»¥ä½œä¸ºæ ‡æ†çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ—¥å¸¸ç”¨åˆ°çš„ç»å…¸é¡¹ç›®çœ‹å‡ºï¼Œä¸€ä¸ªæˆç†Ÿçš„é¡¹ç›®å¿…ç„¶æ”¯æŒæœ¬åœ°å¯åŠ¨æ‰“åŒ…ã€æ”¯æŒçƒ­æ›´æ–°ã€æ”¯æŒé¢„å‘è§„åˆ™å’Œä»£ç é£æ ¼æ£€æŸ¥ï¼Œæ”¯æŒæ¯”è¾ƒæµè¡Œçš„è¯­è¨€æ¡†æ¶ï¼ˆæ¯”å¦‚ lessï¼Œscss ç­‰ï¼‰ï¼Œæ›´å®Œå–„ç‚¹è¿˜ä¼šæ”¯æŒå•å…ƒæµ‹è¯•ã€‚

å¦‚æœå¤§å®¶åªæ˜¯æƒ³è¦å¿«é€Ÿäº†è§£è„šæ‰‹æ¶çš„æ­å»ºæµç¨‹ï¼Œå¯ä»¥ç”¨æ¯”è¾ƒç†Ÿæ‚‰çš„ [create-react-app](https://www.html.cn/create-react-app/docs/getting-started/) å’Œ [vue-cli](https://cli.vuejs.org/zh/guide/cli-service.html)æ­å»ºä¸€ä¸ªé¡¹ç›®ä½œä¸ºæ¨¡æ¿é¡¹ç›®ã€‚å½“ç„¶æˆ‘æ˜¯ä¸€ä¸ªæœ‰è¿½æ±‚æœ‰æ´ç™–çš„é¡µé¢ä»”ï¼Œå–œæ¬¢è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿï¼Œæ‰€ä»¥é¡¹ç›®æ¨¡æ¿æˆ‘è¿˜æ˜¯ä»é›¶å¼€å§‹æ­å»ºäº†ä¸€ä¸ª webpack4+vue+typescript çš„é¡¹ç›®ï¼Œé¡¹ç›®æ­å»ºä»‹ç»æ”¾åœ¨æ–‡ç« åé¢ï¼Œå¿—è¶£ç›¸æŠ•çš„äººå¯ä»¥ç§»æ­¥ä¸‹é¢å»çœ‹ğŸ‘€[ä»é›¶å¼€å§‹æ­å»ºé¡¹ç›®](#ä»é›¶å¼€å§‹æ­å»ºé¡¹ç›®)

####4.2 äº†è§£å¦‚ä½•å‘å¸ƒ npm åŒ…

é¦–å…ˆä½ è¦å‡†å¤‡ä¸€ä¸ª npm è´¦å·ï¼Œå¦‚æœæ²¡æœ‰è¯·åˆ°[å®˜ç½‘](https://www.npmjs.com) æ³¨å†Œã€‚æœ‰äº†è´¦å·åå°±å¯ä»¥è¿›è¡Œ npm åŒ…çš„å¼€å‘å’Œå‘å¸ƒäº†ã€‚

1. åˆå§‹åŒ–ã€‚è¿›å…¥è¦å‘å¸ƒçš„é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ`npm init`å°†å…¶åˆå§‹åŒ–ä¸º npm åŒ…ï¼Œç”Ÿæˆ package.json æ–‡ä»¶
2. ç™»å½•ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ`npm login`ï¼Œæ ¹æ®æç¤ºè¾“å…¥æ³¨å†Œçš„ç”¨æˆ·åã€å¯†ç å’Œé‚®ç®±
3. å‘å¸ƒã€‚åœ¨é¡¹ç›®è·Ÿç›®å½•æ‰§è¡Œ`npm publish`
4. æŸ¥çœ‹ã€‚å‘å¸ƒæˆåŠŸä¹‹åå°±å¯ä»¥åœ¨[npm å®˜ç½‘](https://www.npmjs.com)æŸ¥çœ‹åˆ°è‡ªå·±çš„åŒ…äº†

åœ¨å‘å¸ƒçš„è¿‡ç¨‹ä¸­å¯èƒ½å› ä¸ºä½¿ç”¨äº† npm é•œåƒå¯¼è‡´å¤±è´¥ï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤ä½¿ç”¨[nrm](https://www.npmjs.com/package/nrm)åˆ‡æ¢é•œåƒï¼Œç„¶åå†å‘å¸ƒ
```plain
npm i -g nrm // å®‰è£…nrm

nrm ls // è¾“å‡ºæ‰€æœ‰é•œåƒ

nrm use npm //åˆ‡æ¢é•œåƒ
```

æœ‹å‹ä»¬åœ¨ç»™è‡ªå·±çš„ npm åŒ…èµ·åå­—çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆå»[npm å®˜ç½‘](https://www.npmjs.com)æŸ¥ä¸‹æ˜¯å¦å·²ç»å­˜åœ¨åŒååŒ…ï¼Œæ¯”è¾ƒä¸–ç•Œä¹‹å¤§æŸä¸ªè§’è½æ€»ä¼šæœ‰é‚£ä¹ˆä¸€ä¸ªäººå’Œä½ å¿—åŒé“åˆï¼Œå–œæ¬¢ä¸ŠåŒä¸€ä¸ªåå­—ã€‚


### äº”ã€å®ç°

å‰é¢è¯¥è¯´çš„éƒ½è¯´äº†ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬åŠ¨èµ·æ¥ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ æ­å»ºè„šæ‰‹æ¶ã€‚æˆ‘ä»¬å…ˆé€šè¿‡å›¾äº†è§£ä¸‹è„šæ‰‹æ¶çš„å¤§è‡´å·¥ä½œæµç¨‹ã€‚

![](./13.png)

####5.1 å‡†å¤‡è„šæ‰‹æ¶é¡¹ç›®

ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºåä¸º little-bird-cli çš„æ–‡ä»¶å¤¹ä½œä¸ºè„šæ‰‹æ¶é¡¹ç›®åã€‚ã€æœ€åˆæ˜¯æƒ³è¦å« free-cli çš„ï¼Œå› ä¸ºæˆ‘çˆ±è‡ªç”±ï¼Œä¸€åˆ‡æˆ‘æ¥åˆ›å»ºæˆ‘æ¥å†™ğŸ˜†ï¼Œ[å®˜ç½‘](https://www.npmjs.com)æŸ¥çœ‹å·²å­˜åœ¨ï¼Œå¯æ˜¯è‡ªç”±çš„å¿ƒä¸å˜å‘€ï¼Œæ‰€ä»¥å˜æˆäº†å°å°é¸Ÿï¼Œåœ¨è¿™é‡ŒåŠå¤§å®¶èµ·åè¦è¶æ—©ï¼Œå­¦ä¹ è¦è¶æ—©ã€‘

```plain
mkdir little-bird-cli && cd little-bird-cli
```

ç¬¬äºŒæ­¥ï¼šnpm åˆå§‹åŒ–ï¼Œä»ä¸Šæ–‡å¯ä»¥äº†è§£åˆ°ï¼Œè¦å…ˆåˆå§‹åŒ–ä¸º npm åŒ…ï¼Œåé¢æ‰å¯ä»¥å‘å¸ƒçš„ã€‚
```plain
npm init // åˆå§‹åŒ–åä¼šç”Ÿæˆä¸€ä¸ªpackage.jsonæ–‡ä»¶
```

![](./1.png)

ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹ packgage.jsonã€‚

* ä¿®æ”¹ package.json ä¸­çš„ bin å‚æ•°ï¼Œä¸“é—¨æ”¾ç½®ç”¨æˆ·çš„è‡ªå®šä¹‰å‘½ä»¤ï¼ŒæŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ï¼Œbin é‡Œçš„å‘½ä»¤æ˜¯å¯æ‰§è¡Œå‘½ä»¤ï¼Œæ¨¡å—å®‰è£…çš„æ—¶å€™å¦‚æœæ˜¯å…¨å±€å®‰è£…ï¼Œåˆ™ npm ä¼šä¸º bin ä¸­é…ç½®çš„æ–‡ä»¶åˆ›å»ºä¸€ä¸ªå…¨å±€è½¯è¿æ¥ï¼Œåœ¨å‘½ä»¤è¡Œå·¥å…·é‡Œå¯ä»¥ç›´æ¥æ‰§è¡Œã€‚
* ä¿®æ”¹ package.json ä¸­çš„ scripts å‚æ•°ï¼ŒæŒ‡å®šå¯æ‰§è¡Œå‘½ä»¤ï¼Œå®æ—¶ç¼–è¯‘è„šæœ¬ï¼Œè®© node èƒ½å¤Ÿè¯†åˆ«å¹¶æ‰§è¡Œã€‚

>package.json

```plain
{
  "name": "little-bird-cli",
  "version": "0.0.1",
  "description": "å‰ç«¯è„šæ‰‹æ¶CLIå·¥å…·",
  "main": "index.js",
  "scripts": {
     "compile": "babel src -d dist",
    "watch": "npm run compile -- --watch"
  },
  "bin": {
        "little-bird-cli": "./bin/cmd",
        "lb-cli": "./bin/cmd",
        "lbc": "./bin/cmd"
  },
  "keywords": [
    "è„šæ‰‹æ¶"
  ],
  "author": "luoyang",
  "license": "ISC"
}
```

* æ–°å»º .babelrc é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒ ES6 é¢„å‘è½¬ä¹‰

>.babelrc

```plain
{
    "presets": [
        [
            "env",
            {
                "targets": {
                    "node": "current"
                }
            }
        ]
    ]
}
```

* å®‰è£…ä¾èµ–åˆ†æé‡Œåˆ—å‡ºæ¥çš„é‚£äº›ä¾èµ–

```plain
npm install --save babel-cli babel-env commander inquirer download-git-repo chalk ora log-symbols
```

* è¡¥å…¨ç›®å½•ç»“æ„

```plain
â”œâ”€â”€ bin
â”‚   â””â”€â”€ cmd            //å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ dist
    â”œâ”€â”€ ...             //ç¼–è¯‘åçš„ç”Ÿæˆæ–‡ä»¶
â””â”€â”€ src
    â”œâ”€â”€ main.js         // å…¥å£æ–‡ä»¶
    â”œâ”€â”€ create.js       // é¡¹ç›®åˆ›å»º
    â”œâ”€â”€ init.js         // é¡¹ç›®åˆå§‹åŒ–
    â”œâ”€â”€ dev.js         // é¡¹ç›®å¯åŠ¨
    â”œâ”€â”€ util.js         // å·¥å…·æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä¸€äº›åŸºç¡€æ–¹æ³•ï¼š åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸‹è½½æ¨¡æ¿ç­‰
    â””â”€â”€ webpack.config.js // é¡¹ç›®æ‰“åŒ…é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æŠŠæ¨¡æ¿é¡¹ç›®é‡Œçš„é€šç”¨æ‰“åŒ…é…ç½®æ”¾åœ¨è„šæ‰‹æ¶é‡Œç»´æŠ¤ï¼Œç”¨æˆ·ä¸ç”¨å…³å¿ƒæ‰“åŒ…é…ç½®
â”œâ”€â”€ .babelrc
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
```

###5.2 é…ç½®å…¨å±€ CLI å‘½ä»¤

æˆ‘ä»¬çš„è„šæ‰‹æ¶å¼€å‘å®Œæˆå‘å¸ƒåˆ° npm åï¼Œå¯ä»¥é€šè¿‡`npm install -g free-cli`å…¨å±€å®‰è£…çš„æ–¹å¼å®‰è£…å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ CLI å‘½ä»¤äº†ï¼Œä½†æ˜¯å¼€å‘è¿‡ç¨‹ä¸­ä¸ºäº†æ–¹ä¾¿è°ƒè¯•å’Œå®æ—¶åŒæ­¥ä¿®æ”¹ï¼Œè¿˜éœ€è¦å¦å¤–çš„æ–¹å¼å°† CLI å‘½ä»¤é“¾æ¥åˆ°å…¨å±€ã€‚å¯ä»¥åœ¨ little-bird-cli ç›®å½•ä¸‹æ‰§è¡Œ`npm link`ï¼Œè¯¥å‘½ä»¤å¯ä»¥å°† little-bird-cli ä¸‹çš„ bin å‘½ä»¤è½¯é“¾æ¥åˆ°å…¨å±€ï¼Œç›´æ¥ä½¿ç”¨ã€‚

åœ¨ä½¿ç”¨`npm link`çš„æ—¶å€™é‡åˆ°è¿‡å‡ ä¸ªå°å‘è¿™é‡Œä¹Ÿç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°æ‰§è¡Œå‘½ä»¤å¤±è´¥çš„æƒ…å†µï¼Œæ¯”å¦‚`zsh: command not found: little-bird-cli` ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å°è¯•é‡æ–°é“¾æ¥`npm link`ï¼Œå†å¤±è´¥çš„è¯å°±å°è¯•å…ˆåˆ é™¤æ‰å…¨å±€å‘½ä»¤`npm unlink little-bird-cli`ç„¶åå†é“¾æ¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™æ ·å°±å¯ä»¥è§£å†³äº†ã€‚ä½†æœ‰æ—¶å€™ä¹Ÿä¼šé‡åˆ°é¡½ç–¾è¿™ä¸ªæ—¶å€™å°±è¦ä½¿ç”¨ç»ˆæå¤§æ³•äº†ï¼Œå»å…¨å±€ç›®å½•é‡Œåˆ é™¤ã€ä¸‹é¢æ˜¯ mac çš„æƒ…å†µï¼Œwindow çš„å¯ä»¥æ ¹æ®é”™è¯¯æç¤ºæ‰¾åˆ°å…¨å±€ç›®å½•ã€‘ï¼Œæ–¹æ³•å¦‚ä¸‹

```plain
/usr/local/bin   // è¿›å…¥å…¨å±€å‘½ä»¤ç›®å½•
rm -rf little-bird-cli  // åˆ é™¤å‘½ä»¤
```

###5.3 é¡¹ç›®å¯åŠ¨

é¡¹ç›®å¯åŠ¨å‰ï¼Œæˆ‘ä»¬å…ˆé…ç½®ä¸‹å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå†™ä¸ªç®€å•çš„ demoï¼Œç”¨æ¥å¯åŠ¨åéªŒè¯é¡¹ç›®å¯ä»¥æ­£å¸¸è¿è½¬ã€‚å¯æ‰§è¡Œæ–‡ä»¶çš„è¡Œé¦–ä¸€å®šè¦åŠ å…¥`#!/usr/bin/env node`è¿™è¡Œä»£ç å¯ä»¥å‘Šè¯‰ç³»ç»Ÿè¯¥è„šæœ¬å¯ä»¥ç”± node æ¥æ‰§è¡Œã€‚

>bin/cmd

```plain
#!/usr/bin/env node
require('../dist/main.js');
```

>src/main.js

```plain
console.log('æˆ‘æ˜¯ä¸€ä¸ªå¯ä»¥æ­£å¸¸è¿è¡Œçš„é¡¹ç›®å•¦ï¼ï¼ï¼')
```

å¼€å¯é¡¹ç›®çš„å®æ—¶ç›‘æ§`npm run watch`ï¼Œè¿™æ ·æˆ‘ä»¬ä¿®æ”¹ä»£ç çš„æ—¶å€™å°±ä¼šå®æ—¶æ›´æ–°äº†ã€‚
![](./2.png)

æ¥ä¸‹æ¥è§è¯å¥‡è¿¹çš„æ—¶å€™åˆ°äº†ï¼Œå¯ä»¥éšä¾¿æ‰¾ä¸€ä¸ªç›®å½•æ‰§è¡Œ bin é‡Œè‡ªå®šä¹‰çš„å‘½ä»¤ã€ä½œä¸ºä¸€ä¸ªæ€¥æ€§å­ï¼Œå¤šä¸€ä¸ªå­—æ¯éƒ½ä¸æ„¿æ„å†™ï¼Œæ‰€ä»¥æˆ‘ä¼šç”¨æœ€ç®€å•çš„é‚£ä¸ªå‘½ä»¤ğŸ˜†`lbc`ã€‘

![](./3.png)

###5.4 å¤„ç†å‘½ä»¤è¡Œ

æˆ‘ä»¬é€šè¿‡ commander æ¥è®¾ç½®ä¸åŒçš„å‘½ä»¤ã€‚command æ–¹æ³•è®¾ç½®å‘½ä»¤çš„åå­—ã€description æ–¹æ³•æ˜¯è®¾ç½®å‘½ä»¤çš„æè¿°ã€alias æ–¹æ³•è®¾ç½®å‘½ä»¤ç®€ç§°ã€æ‡’äººå¿…å¤‡ã€‘ã€options è®¾ç½®å‘½ä»¤éœ€è¦çš„å‚æ•°ã€‚commander æ›´è¯¦ç»†çš„æ–‡æ¡£å¯ä»¥å» commander[å®˜ç½‘](https://github.com/tj/commander.js/)æŸ¥çœ‹ã€‚æˆ‘ä»¬è„šæ‰‹æ¶å…ˆåŠ å…¥ä¸‰ä¸ªå‘½ä»¤ï¼šé¡¹ç›®åˆ›å»ºã€é¡¹ç›®åˆå§‹åŒ–ã€é¡¹ç›®å¯åŠ¨ã€‚

>src/main.js

```plain
import program from 'commander';
import symbol from 'log-symbols';
import chalk from 'chalk';

import create from './create'; // é¡¹ç›®åˆ›å»º
import init from './init'; // é¡¹ç›®åˆå§‹åŒ–
import dev from './dev'; // é¡¹ç›®å¯åŠ¨

/**
 * little-bird-cli å‘½ä»¤åˆ—è¡¨
 */

let actionMap = {
    // é¡¹ç›®åˆ›å»º
    create: {
        description: 'åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®', // æè¿°
        usages: [// ä½¿ç”¨æ–¹æ³•
            'little-bird-cli create ProjectName',
            'lb-cli create ProjectName',
            'lbc create ProjectName'
        ],
        alias: 'c' // å‘½ä»¤ç®€ç§°
    },
    // é¡¹ç›®åˆå§‹åŒ–
    init: {
        description: 'åˆå§‹åŒ–é¡¹ç›®',
        usages: [
            'little-bird-cli init',
            'lb-cli init',
            'lbc init'
        ],
        alias: 'i'
    },
    // å¯åŠ¨é¡¹ç›®
    dev: {
        description: 'æœ¬åœ°å¯åŠ¨é¡¹ç›®',
        usages: [
            'little-bird-cli dev',
            'lb-cli dev',
            'lbc dev'
        ],
        options: [
            {
                flags: '-p --port <port>',
                description: 'ç«¯å£',
                defaultValue: 3000
            }
        ],
        alias: 'd'
    }
}

// æ·»åŠ create,init,devå‘½ä»¤
Object.keys(actionMap).forEach(action => {

    if (actionMap[action].options) {
        Object.keys(actionMap[action].options).forEach(option => {
            let obj = actionMap[action].options[option];
            program.option(obj.flags, obj.description, obj.defaultValue);
        })
    }

    program
        .command(action)
        .description(actionMap[action].description)
        .alias(actionMap[action].alias)
        .action(() => {
            switch (action) {
                // åˆ°è¿™é‡Œå…·ä½“å‘½ä»¤å®ç°é€»è¾‘è¿˜ç©ºç¼ºï¼Œæˆ‘ä»¬å…ˆæ‰“æ—¥å¿—ï¼Œçœ‹ä¸‹å‘½ä»¤å¤„ç†æƒ…å†µ
                case 'create':
                    const ProjectName = process.argv.slice(3);
                    console.log(symbol.info, chalk.yellow(`æ”¶åˆ°é¡¹ç›®åˆ›å»ºå‘½ä»¤äº†ï¼Œæ–°åˆ›å»ºçš„é¡¹ç›®åä¸º ${ProjectName}`));
                    // create(...process.argv.slice(3));
                    break;
                case 'init':
                    console.log(symbol.info, chalk.yellow(`é¡¹ç›®åˆå§‹åŒ–`));
                    // init(...process.argv.slice(3));
                    break;
                case 'dev':
                    console.log(symbol.info, chalk.yellow(`é¡¹ç›®å¯åŠ¨ï¼Œç«¯å£å·ä¸º${program.port}`));
                    // dev(program.port);
                    break;
                default:
                    break;
            }
        })
});

// é¡¹ç›®ç‰ˆæœ¬
program
    .version(require('../package.json').version, '-v --version')
    .parse(process.argv);

/**
 * little-bird-cliå‘½ä»¤åä¸å¸¦å‚æ•°çš„æ—¶å€™ï¼Œè¾“å‡ºå¸®åŠ©ä¿¡æ¯
 */
if (!process.argv.slice(2).length) {
    program.outputHelp();
}

```

æ‰§è¡Œå‘½ä»¤è¾“å‡ºç»“æœ

![](./4.png)

###5.5 é¡¹ç›®åˆ›å»º

é¡¹ç›®åˆ›å»ºæ€è·¯å¦‚ä¸‹ï¼š

* é¡¹ç›®åˆ›å»ºå‘½ä»¤å¿…é¡»è¾“å…¥æ–°å»ºé¡¹ç›®åç§°
* å½“å‰è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨ç›¸åŒæ–‡ä»¶åï¼Œå¦‚æœä¸åšè¿™å±‚åˆ¤æ–­æ–°ç”Ÿæˆçš„é¡¹ç›®å¯èƒ½ä¼šè¦†ç›–ä½ å·²æœ‰çš„é¡¹ç›®
```plain
    // åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å·²ç»å­˜åœ¨
    let notExistFold = async (name) => {
    return new Promise((resolve) => {
        if (fs.existsSync(name)) {
            console.log(symbol.error, chalk.red('æ–‡ä»¶å¤¹åå·²è¢«å ç”¨ï¼Œè¯·æ›´æ¢åå­—é‡æ–°åˆ›å»º'));
        } else {
            resolve();
        }
    });
}
```

* è¯¢é—®ç”¨æˆ·ï¼Œå¼•å¯¼ç”¨æˆ·è¾“å…¥é…ç½®ä¿¡æ¯
```plain
// è¯¢é—®ç”¨æˆ·
let promptList = [
    {
        type: 'list',
        name: 'frame',
        message: 'please choose this project template',
        choices: ['vue', 'react']
    },
    {
        type: 'input',
        name: 'description',
        message: 'Please enter the project description: '
    },
    {
        type: 'input',
        name: 'author',
        message: 'Please enter the author name: '
    }
];

let prompt = () => {
    return new Promise(resolve => {
        inquirer
            .prompt(promptList)
            .then(answer => {
                resolve(answer);
            })
    });
}
```
* ä¸‹è½½æ¨¡æ¿é¡¹ç›®ï¼Œä¸‹è½½æ¨¡ç‰ˆæ¯”è¾ƒè€—æ—¶ï¼Œé€šè¿‡ ora æç¤ºç”¨æˆ·æ­£åœ¨ä¸‹è½½æ¨¡ç‰ˆï¼Œä¸‹è½½ç»“æŸåå†ç»™å‡ºæç¤º
```plain
// apiä¸ºè¿œç«¯åœ°å€ï¼ŒProjectNameä¸ºé¡¹ç›®åˆ›å»ºæ—¶è¾“å…¥çš„é¡¹ç›®å
let  downloadTemplate = async (ProjectName, api) => {
    return new Promise((resolve, reject) => {
        downloadGit(api, ProjectName, {clone: true}, (err) => {
            if(err){
                reject(err);
            }else{
                resolve();
            }
        })
    });
};
```
* é¡¹ç›®ä¸‹è½½å®Œæˆåï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥æ›´æ–°é…ç½®æ–‡ä»¶
```plain
// æ›´æ–°jsoné…ç½®æ–‡ä»¶
let updateJsonFile = (fileName, obj) => {

    return new Promise(resolve => {
        if(fs.existsSync(fileName)){
            const data = fs.readFileSync(fileName).toString();
            let json = JSON.parse(data);
            Object.keys(obj).forEach(key => {
                json[key] = obj[key];
            });
            fs.writeFileSync(fileName, JSON.stringify(json, null, '\t'), 'utf-8');
            resolve();
        }
    });
}
```

å¯åŠ¨é¡¹ç›®è¦ç”¨çš„å·¥å…·æ–¹æ³•å·²ç»å†™å¥½ï¼Œä¸‹é¢æˆ‘ä»¬è¿›å…¥åˆ›å»ºæ­£æ–‡ï¼š

>src/create.js

```plain


import symbol from 'log-symbols';
import chalk from 'chalk';
import ora from 'ora';

import {
    notExistFold,
    prompt,
    downloadTemplate,
    updateJsonFile
} from './util';

let create = async (ProjectName) => {

    // é¡¹ç›®åä¸èƒ½ä¸ºç©º
    if (ProjectName === undefined) {
        console.log(symbol.error, chalk.red('åˆ›å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œè¯·è¾“å…¥é¡¹ç›®å'));
    } else {
        // å¦‚æœæ–‡ä»¶åä¸å­˜åœ¨åˆ™ç»§ç»­æ‰§è¡Œ,å¦åˆ™é€€å‡º
        notExistFold(ProjectName).then(() => {

            // ç”¨æˆ·è¯¢é—®äº¤äº’
            prompt().then((answer) => {

                // ç›®å‰åªå»ºäº†ä¸€ä¸ªvueçš„æ¨¡æ¿ï¼Œæ‰€ä»¥åªèƒ½å…ˆè·³è¿‡reactğŸŒ¶ 
                if (answer.frame === 'react') {
                    console.log(symbol.warning, chalk.yellow('reactæ¨¡æ¿è¿˜åœ¨è·¯ä¸Šï¼Œè«æ€¥è«æ€¥~'));
                    process.exit(1);
                }

                /**
                 * æ ¹æ®ç”¨æˆ·è¾“å…¥çš„é…ç½®ä¿¡æ¯ä¸‹è½½æ¨¡ç‰ˆ&æ›´æ–°æ¨¡ç‰ˆé…ç½®
                 * ä¸‹è½½æ¨¡ç‰ˆæ¯”è¾ƒè€—æ—¶,è¿™é‡Œé€šè¿‡oraæ’å…¥ä¸‹è½½loading, æç¤ºç”¨æˆ·æ­£åœ¨ä¸‹è½½æ¨¡ç‰ˆ
                 */
                let loading = ora('æ¨¡æ¿ä¸‹è½½ä¸­...');
                loading.start();

                let Api = '';
                switch (answer.frame) {
                    case 'vue':
                        Api = 'direct:https://github.com/LuoYangYY/vue-template.git';
                        break;
                    case 'react':
                        Api = 'direct:https://github.com/LuoYangYY/react-template.git';
                        break;
                    default:
                        break;
                }

                downloadTemplate(ProjectName, Api)
                .then(() => {

                    loading.succeed('æ¨¡æ¿ä¸‹è½½æˆåŠŸ');

                    // ä¸‹è½½å®Œæˆå,æ ¹æ®ç”¨æˆ·è¾“å…¥æ›´æ–°é…ç½®æ–‡ä»¶
                    const fileName = `${ProjectName}/package.json`;
                    answer.name = ProjectName;
                    updateJsonFile(fileName, answer)
                    .then(() => {
                        console.log(symbol.success, chalk.green('Project package.json
                         update finished!'));
                    })
                }, () => {
                    loading.fail('æ¨¡æ¿ä¸‹è½½å¤±è´¥');
                });
            })
        });
    }
};

module.exports = create;

```

å¼‚å¸¸æƒ…å†µè¾“å‡º

![](./6.png)

é¡¹ç›®åˆ›å»ºæˆåŠŸè¾“å‡º

![](./7.png)

###5.6 é¡¹ç›®åˆå§‹åŒ–

é¡¹ç›®åˆå§‹åŒ–ä¸»è¦åšä»¥ä¸‹å‡ ç‚¹ï¼š

* å®‰è£…ä¾èµ–ï¼Œä¸ºäº†å‡å°é¡¹ç›®æ¨¡æ¿åŒ…çš„å¤§å°ï¼Œä¸‹è½½çš„æ¨¡æ¿é‡Œä¸åŒ…å« node_modules ç›®å½•ï¼Œåˆ›å»ºå®Œæˆä¹‹åè¦å®‰è£…ä¾èµ–
* åˆå§‹åŒ– git ä»“åº“ï¼Œæ–¹ä¾¿ä»£ç æäº¤ç®¡ç†
* è‡ªåŠ¨åœ¨è¿œç«¯ç”Ÿæˆ git ä»“åº“ï¼Œè¿™ä¸€æ­¥åç»­æ–‡ç« è¡¥å……ï¼Œè¿™é‡Œå°±å…ˆä¸å†™äº†

>src/init.js

```plain
import child from 'child_process';
import symbol from 'log-symbols';
import chalk from 'chalk';

let init = () => {
    child.exec(`git init`, () => {
        console.log(symbol.success, chalk.green('git åˆå§‹åŒ–å®Œæˆ'));
        child.exec(`npm install`, (error, stdout, stderr) => {
            console.log(symbol.success, chalk.green(stdout));
            console.log(symbol.error,  chalk.red(stderr));
            if (error !== null) {
                console.log(symbol.error, chalk.red(error));
            }else{
                console.log(symbol.success,  chalk.green('npmä¾èµ–å®‰è£…å®Œæˆ'));
            }
        },(err)=> {
            console.log(err)
        })
    },(err)=> {
        console.log(err)
    })
}

module.exports = init;
```

è¿›å…¥åˆ°é¡¹ç›®ç›®å½•ï¼Œæ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤ã€è¿™é‡Œæœ‰ä¸ªä¿å­˜æ˜¯å› ä¸ºæ²¡æœ‰æ·»åŠ è¿œç«¯ä»“åº“ï¼Œä¸å½±å“ä½¿ç”¨çš„ã€‘

![](./8.png)

###5.7 é¡¹ç›®å¯åŠ¨

æ‰€è°“é¡¹ç›®å¯åŠ¨å°±æ˜¯è¯´å¯ä»¥è®©æˆ‘ä»¬çš„é¡¹ç›®æœ¬åœ°è¿è¡Œã€‚å‰ç«¯é¡¹ç›®æœ¬åœ°è¿è¡Œæˆ‘ä»¬é€šå¸¸ä¼šå€ŸåŠ©å‰ç«¯è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·æ¥å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªå‰ç«¯é›†æˆå¼€å‘ç¯å¢ƒï¼Œèƒ½å¤Ÿåˆç†ã€å¿«é€Ÿå’Œé«˜æ•ˆçš„è§£å†³å‰ç«¯å¼€å‘ä¸­çš„å·¥ç¨‹å’Œé¡¹ç›®é—®é¢˜ï¼Œé›†æˆäº†æœ¬åœ°è°ƒè¯•ã€æœ¬åœ°æ„å»ºã€è¿œç¨‹éƒ¨ç½²ã€ä»£ç æ ¡éªŒç­‰ä¸€äº›åˆ—å¼€å‘å·¥å…·ã€‚å…¶ä¸­æœ€ä¸ºçªå‡ºçš„å½“å±äºç”¨æˆ·æ¨¡å—åŒ–æ‰“åŒ…çš„ webpack å’Œç”¨æˆ·ä»»åŠ¡æµç¨‹æ„å»ºçš„ Gulpã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ˜¯å€ŸåŠ© webpack æ¥å®ç°æˆ‘ä»¬è„šæ‰‹æ¶çš„æœ¬åœ°å¯åŠ¨ã€‚

å…ˆæ¥åšä¸‹ä¾èµ–åˆ†æã€ä¸»è¦é’ˆå¯¹æˆ‘è‡ªå·±æ­çš„ webpack4+vue+typescript é¡¹ç›®ã€‘

* åœ¨ webpack4 ä¸­å·²ç»å°† webpack å’Œå®ƒçš„ cli åˆ†å¼€äº†ï¼Œæ‰€ä»¥éœ€å¼•å…¥ webpack å’Œ webpack-cli
* æ”¯æŒçƒ­æ›´æ–°ï¼Œéœ€å¼•å…¥ webpack-dev-server
* å½“ä½¿ç”¨ webpack æ‰“åŒ…æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª html æ–‡ä»¶ï¼Œå¹¶æŠŠ webpack æ‰“åŒ…åçš„é™æ€æ–‡ä»¶è‡ªåŠ¨æ’å…¥åˆ°è¿™ä¸ª html æ–‡ä»¶å½“ä¸­ï¼Œéœ€å¼•å…¥ html-webpack-plugin
* æ”¯æŒå¯åŠ¨åè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œéœ€å¼•å…¥ open-browser-webpack-plugin
* æ”¯æŒ vue è§£æï¼Œéœ€å¼•å…¥ vue-loader å’Œ vue-template-compiler
* æ”¯æŒ styleã€cssã€less è§£æ,éœ€å¼•å…¥ style-loaderã€css-loader å’Œ less-loader
* æ”¯æŒ typescriptï¼Œ éœ€å¼•å…¥ ts-loader

* åœ¨è„šæ‰‹æ¶ç›®å½•(little-bird-cli)ä¸‹å®‰è£…ä¾èµ–

```plain
npm i webpack webpack-cli  webpack-dev-server html-webpack-plugin
 open-browser-webpack-plugin vue vue-loader vue-template-compiler style-loader 
 css-loader less less-loader typescript ts-loader -S
```

* å‡†å¤‡ webpack é…ç½®æ–‡ä»¶

>src/webpack.config.js

```plain


const VueLoaderPlugin = require('vue-loader/lib/plugin'); //å¼•å…¥vue-loaderåº“
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
    mode: 'development', // production
    watch: true,
    watchOptions: {
        // ä¸ç›‘å¬çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼Œæ”¯æŒæ­£åˆ™åŒ¹é…
        // é»˜è®¤ä¸ºç©º
        ignored: /node_modules/,
        // ç›‘å¬åˆ°å˜åŒ–å‘ç”Ÿåä¼šç­‰300mså†å»æ‰§è¡ŒåŠ¨ä½œï¼Œé˜²æ­¢æ–‡ä»¶æ›´æ–°å¤ªå¿«å¯¼è‡´é‡æ–°ç¼–è¯‘é¢‘ç‡å¤ªé«˜
        // é»˜è®¤ä¸º 300ms
        aggregateTimeout: 300,
        // åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å‘ç”Ÿå˜åŒ–æ˜¯é€šè¿‡ä¸åœçš„å»è¯¢é—®ç³»ç»ŸæŒ‡å®šæ–‡ä»¶æœ‰æ²¡æœ‰å˜åŒ–å®ç°çš„
        // é»˜è®¤æ¯éš”1000æ¯«ç§’è¯¢é—®ä¸€æ¬¡
        poll: 1000
    },
    entry: './src/index.ts', // å…¥å£æ–‡ä»¶
    devtool: 'cheap-module-eval-source-map', //ä¸åŒ…å«åˆ—ä¿¡æ¯ï¼ŒåŒæ—¶ loader çš„ sourcemap ä¹Ÿè¢«ç®€åŒ–ä¸ºåªåŒ…å«å¯¹åº”è¡Œçš„
    module: {
        rules: [{
            test: /\.vue$/,
            use: 'vue-loader'
        }, //vueåŠ è½½å™¨
        {
            test: /\.tsx?$/,
            loader: 'ts-loader', //tsåŠ è½½å™¨
            options: {
                transpileOnly: true,
                appendTsSuffixTo: [/.vue$/]
            }Â  //è®¤è¯†vueæ–‡ä»¶

        }, {
            test: /\.(css|less)$/,
            loader: 'vue-style-loader!less-loader!css-loader'
        } //cssåŠ è½½å™¨
        ]
    },
    plugins: [new VueLoaderPlugin()  //vue-loaderæ’ä»¶åŠ è½½æ–¹å¼
        ,new HtmlWebpackPlugin({ //æ­¤éƒ¨åˆ†æ–°å¢åŠ 
            template: './public/index.html',//éœ€è¦è‡ªåŠ¨æ³¨å…¥çš„æ¨¡æ¿çš„æ–‡ä»¶åç§°
            inject: true//æ˜¯å¦è‡ªåŠ¨æ³¨å…¥ç”Ÿæˆåçš„æ–‡ä»¶
        })
    ],
    devtool: '#eval-source-map'
}
```

* å†™å¯åŠ¨å‘½ä»¤

>src/dev.js

```plain
import webpack from "webpack";
import WebpackDevServer from 'webpack-dev-server';
const OpenBrowserPlugin = require('open-browser-webpack-plugin');

const config = require('./webpack.config.js');

let dev = (port) => {
    // å¯åŠ¨é¡¹ç›®åè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    config.plugins.push(new OpenBrowserPlugin({ url: `http://localhost:${port}` }))
    new WebpackDevServer(webpack(config), {
        contentBase: './public',
        hot: true,
        historyApiFallback: true
    }).listen(port, 'localhost', function (err, result) {
        if (err) {
            console.log(err);
        }
    });
}

module.exports = dev;
```

é¡¹ç›®å¯åŠ¨å‘½ä»¤å®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥å»åˆšæ‰åˆ›å»ºçš„é¡¹ç›®é‡Œè¯•ä¸€ä¸‹äº†
![](./9.png)

### 5.8 å‘å¸ƒ&ä½¿ç”¨

å½“å½“å½“...å°ä¼™ä¼´ä»¬è¿«ä¸åŠå¾…çœ‹æˆå“äº†å§ï¼Œå†ç­‰ä¸€ä¸‹ï¼Œè®©æˆ‘ä»¬å…ˆå‘å¸ƒ

![](./10.png)

åœ¨ npm[å®˜ç½‘](https://www.npmjs.com)æŸ¥çœ‹æ˜¯å¦å¯ä»¥æœåˆ°

![](./11.png)

å®Œæˆï¼å¯ä»¥é€šè¿‡`npm i -g little-bird-cli`å®‰è£…è„šæ‰‹æ¶åŒ…ï¼Œè£…ä¹‹å‰æœ€å¥½å…ˆæŠŠä¹‹å‰å¼€å‘æ—¶é“¾åˆ°å…¨å±€çš„å‘½ä»¤åˆ é™¤æ‰ï¼Œå®‰è£…æˆåŠŸä¹‹åå°±å¯ä»¥ä½¿ç”¨äº† biubiubiubiu~

```plain
npm unlink little-bird-cli
npm unlink lb-cli
npm unlink lbc
npm i -g little-bird-cli
```

æ‰§è¡Œ`lbc dev -p 8001`æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€è®¿é—®æœ¬åœ°é¡¹ç›®

![](./12.png)

### å…­ã€æ‹“å±•

é™¤äº†å®ç°æ¨¡æ¿åˆ›å»ºå’Œæœ¬åœ°å¯åŠ¨çš„åŠŸèƒ½ï¼Œè¿˜å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ‹“å±•ï¼Œæ¯”å¦‚ç‰ˆæœ¬æ ¡éªŒã€è„šæ‰‹æ¶æ›´æ–°ã€webpack è‡ªå®šä¹‰ã€ä»£ç æ ¡éªŒã€è‡ªåŠ¨åŒ–æµ‹è¯•ç­‰ï¼Œè¿™äº›éƒ½å¯ä»¥ä½œä¸ºå¼€å‘è€…çš„è¾…åŠ©å·¥å…·ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚æœ¬æ–‡åªæ˜¯å¸¦å¤§å®¶å…¥é—¨ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç»§ç»­æ·±å…¥å°è¯•ã€‚

### ä¸ƒã€ä»é›¶å¼€å§‹æ­å»ºé¡¹ç›®

è¿™é‡Œä»‹ç»ä¸€ä¸‹ WebPack 4 +TypeScript 3 +Vue +less ç®€å•ç¯å¢ƒæ­å»º

####7.1 é¡¹ç›®åˆå§‹åŒ–
```plain
mkdir vue-template && cd vue-template
mkdir public
mkdir src && cd  src
mkdir components 
mkdir assets
cd ../
npm init
git init
```

####7.2 ä¾èµ–å®‰è£…

* Typescript çš„ç›¸å…³å®‰è£…
```plain
npm i typescript ts-loader --save-dev
```

* webpack çš„ç›¸å…³å®‰è£…
```plain
npm i webpack webpack-cli --save-dev
```

* vue çš„ç›¸å…³å®‰è£…
```plain
npm i vue vue-loader vue-template-compiler --save-dev
```

* css ç›¸å…³å®‰è£…
```plain
npm i css-loader style-loader less less-loader -save-dev
```

* å…¶ä»–æ’ä»¶å®‰è£…
```plain
npm i html-webpack-plugin webpack-dev-server --save-dev 
```

####7.3 é…ç½®æ–‡ä»¶
* é¡¹ç›®æ ¹ç›®å½•åˆ›å»º tsconfig.jsonï¼ˆå¼€å§‹ç”¨ä¸ä¸Šï¼Œä½†æ˜¯è¯¥æ–‡ä»¶åˆ›å»ºåæ— éœ€è¦å˜åŠ¨ï¼‰
* é¡¹ç›®æ ¹ç›®å½•åˆ›å»º webpack.config.json
```plain
const path = require('path');
const VueLoaderPlugin = require('vue-loader/lib/plugin'); //å¼•å…¥vue-loaderåº“
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
    entry: './src/index.ts', // å…¥å£æ–‡ä»¶
    devtool: 'cheap-module-eval-source-map', //ä¸åŒ…å«åˆ—ä¿¡æ¯ï¼ŒåŒæ—¶ loader çš„ sourcemap ä¹Ÿè¢«ç®€åŒ–ä¸ºåªåŒ…å«å¯¹åº”è¡Œçš„
    module: {
        rules: [{
            test: /\.vue$/,
            use: 'vue-loader'
        }, //vueåŠ è½½å™¨
        {
            test: /\.tsx?$/,
            loader: 'ts-loader', //tsåŠ è½½å™¨
            options: {
                transpileOnly: true,
                appendTsSuffixTo: [/.vue$/]
            }Â  //è®¤è¯†vueæ–‡ä»¶

        }, {
            test: /\.(css|less)$/,
            loader: 'vue-style-loader!less-loader!css-loader'
        } //cssåŠ è½½å™¨
        ]
    },
    plugins: [new VueLoaderPlugin()  //vue-loaderæ’ä»¶åŠ è½½æ–¹å¼
        ,new HtmlWebpackPlugin({ //æ­¤éƒ¨åˆ†æ–°å¢åŠ 
            template: './public/index.html',//éœ€è¦è‡ªåŠ¨æ³¨å…¥çš„æ¨¡æ¿çš„æ–‡ä»¶åç§°
            inject: true//æ˜¯å¦è‡ªåŠ¨æ³¨å…¥ç”Ÿæˆåçš„æ–‡ä»¶
        })
    ],
    devtool: '#eval-source-map'
}

```

* ä¿®æ”¹é…ç½®æ–‡ä»¶ package.json
```plain
"scripts": {
    "dev":"webpack-dev-server --open --mode development"
}
```

####7.4 æ–°å»ºæ–‡ä»¶
* public ç›®å½•æ–°å»ºä¸»å…¥å£æ–‡ä»¶ index.html
```plain
 <!DOCTYPE html>
<html>
Â  <head>
Â Â Â  <meta charset="utf-8">
Â Â Â  <meta name="viewport" content="width=device-width,initial-scale=1.0">
Â Â Â  <title>vue-template</title>
Â  </head>
Â  <body>
Â Â Â  <div id="app"></div>
  </body>
</html>
```
* src ç›®å½•æ–°å»º vue æ¨¡æ¿æ–‡ä»¶ App.vue
```plain
<template>
    <div>
        {{msg}}
    </div>
</template>

<script lang="ts">
import Vue from 'vue'
export default Vue.extend({
    data() {
        return {
            msg: 'hello world'
        }
    },
})
</script>
```

* src ç›®å½•ä¸‹æ–°å»º vue å…¥å£æ–‡ä»¶ index.ts
```plain
import Vue from 'vue'
import App from './App.vue';

new Vue(
    {
        el:'#app',
        render:h=>h(App)
    }
)
```

####7.5 å¯åŠ¨é¡¹ç›®

```plain
npm run dev
```

####7.6 ç²¾ç®€

ä¸€ä¸ªç®€å• WebPack 4 +TypeScript 3 +Vue +less é¡¹ç›®å·²ç»æ­å®Œäº†ï¼Œä½œä¸ºè„šæ‰‹æ¶çš„é¡¹ç›®æ¨¡æ¿ï¼Œæœ‰äº›åŠŸèƒ½æˆ‘ä»¬ä¼šç›´æ¥ç»§æ‰¿åˆ°è„šæ‰‹æ¶é‡Œï¼Œæ‰€ä»¥è¿˜ä¼šå¯¹ä¸Šé¢æ­å»ºçš„é¡¹ç›®æ¨¡æ¿åšäº›ç²¾ç®€å·¥ä½œã€‚æ¯”å¦‚é¡¹ç›®å¯åŠ¨ä¼šç»§æ‰¿åˆ°è„šæ‰‹æ¶é‡Œï¼Œé‚£ä¹ˆè¯¥é¡¹ç›®é‡Œçš„ç›¸å…³å†…å®¹åˆ™å¯å»æ‰
* å»æ‰ package.json çš„ dev å‘½ä»¤
* æ¸…ç©º webpack.config.js
* åˆ é™¤ä¾èµ–ï¼šhtml-webpack-plugin webpack-dev-server
